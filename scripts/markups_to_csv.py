import json
import csv
from typing import Dict, Any
from pprint import pprint


"""
markups are the output from model-run-data-task
pts are the output of grid-price-target-wf

region = ''
prod_pt_str = ''
prod_markup_str = ''
treat_pt_str = ''
treat_markup_str = ''
"""

region = 'BNA v2'
prod_pt_str = '{"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "TargetDict", "targets": {"standard": {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "TargetList", "targets": [{"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1396.2790565067721, "lower_limit_cents": 1387.9264400172003, "i": 0, "j": 0, "use_case_i": "airport", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1420.7041906168986, "lower_limit_cents": 1412.2054616600678, "i": 0, "j": 1, "use_case_i": "airport", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1705.1797105838828, "lower_limit_cents": 1694.9792337508786, "i": 0, "j": 2, "use_case_i": "airport", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1981.3572777262898, "lower_limit_cents": 1969.5046918176583, "i": 0, "j": 3, "use_case_i": "airport", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2809.453771959544, "lower_limit_cents": 2792.647468238949, "i": 0, "j": 4, "use_case_i": "airport", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 858.6307382746429, "lower_limit_cents": 853.4943629709063, "i": 1, "j": 0, "use_case_i": "commute", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1039.933068587427, "lower_limit_cents": 1033.7121329827166, "i": 1, "j": 1, "use_case_i": "commute", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1231.1059212887478, "lower_limit_cents": 1223.7413793867215, "i": 1, "j": 2, "use_case_i": "commute", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1558.3056396419622, "lower_limit_cents": 1548.98377140881, "i": 1, "j": 3, "use_case_i": "commute", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2377.615132893646, "lower_limit_cents": 2363.392111161481, "i": 1, "j": 4, "use_case_i": "commute", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 856.7271031432584, "lower_limit_cents": 851.6021154873666, "i": 3, "j": 0, "use_case_i": "other", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1031.6934460923917, "lower_limit_cents": 1025.5218003530554, "i": 3, "j": 1, "use_case_i": "other", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1267.4335714753108, "lower_limit_cents": 1259.8517156140429, "i": 3, "j": 2, "use_case_i": "other", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1566.5289975450778, "lower_limit_cents": 1557.1579367422162, "i": 3, "j": 3, "use_case_i": "other", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2398.64566634338, "lower_limit_cents": 2384.2968388278664, "i": 3, "j": 4, "use_case_i": "other", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 849.555931353136, "lower_limit_cents": 844.4738420329778, "i": 2, "j": 0, "use_case_i": "party time", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 987.04955490154, "lower_limit_cents": 981.1449713228668, "i": 2, "j": 1, "use_case_i": "party time", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1241.103626302822, "lower_limit_cents": 1233.6792775911404, "i": 2, "j": 2, "use_case_i": "party time", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1631.9558572378344, "lower_limit_cents": 1622.1934094378075, "i": 2, "j": 3, "use_case_i": "party time", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2475.1947560202666, "lower_limit_cents": 2460.388007729019, "i": 2, "j": 4, "use_case_i": "party time", "use_case_j": "d5"}]}, "standard_saver": {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "TargetList", "targets": [{"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1101.6490345778855, "lower_limit_cents": 1095.0589107419262, "i": 0, "j": 0, "use_case_i": "airport", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 755.4907913851009, "lower_limit_cents": 750.971404796556, "i": 1, "j": 0, "use_case_i": "commute", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 753.7560460767954, "lower_limit_cents": 749.2470368280808, "i": 3, "j": 0, "use_case_i": "other", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 747.5942798503861, "lower_limit_cents": 743.1221306189781, "i": 2, "j": 0, "use_case_i": "party time", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1159.8728819927626, "lower_limit_cents": 1152.9344599668837, "i": 0, "j": 1, "use_case_i": "airport", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 915.4035450058296, "lower_limit_cents": 909.9275517156652, "i": 1, "j": 1, "use_case_i": "commute", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 908.0039073709032, "lower_limit_cents": 902.5721791114562, "i": 3, "j": 1, "use_case_i": "other", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 868.5797280622259, "lower_limit_cents": 863.3838373659414, "i": 2, "j": 1, "use_case_i": "party time", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1526.3081577055411, "lower_limit_cents": 1517.1777001320286, "i": 0, "j": 2, "use_case_i": "airport", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1133.0921220411578, "lower_limit_cents": 1126.3139039631449, "i": 1, "j": 2, "use_case_i": "commute", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1166.1112957628295, "lower_limit_cents": 1159.1355552099114, "i": 3, "j": 2, "use_case_i": "other", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1141.904743935535, "lower_limit_cents": 1135.0738082788919, "i": 2, "j": 2, "use_case_i": "party time", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1764.9403099106416, "lower_limit_cents": 1754.382341955045, "i": 0, "j": 3, "use_case_i": "airport", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1481.1457345455167, "lower_limit_cents": 1472.2854410188238, "i": 1, "j": 3, "use_case_i": "commute", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1488.6228885677262, "lower_limit_cents": 1479.717866303114, "i": 3, "j": 3, "use_case_i": "other", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1550.2815267645806, "lower_limit_cents": 1541.007659206667, "i": 2, "j": 3, "use_case_i": "party time", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 2578.1665493228165, "lower_limit_cents": 2562.7438182201877, "i": 0, "j": 4, "use_case_i": "airport", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 2262.104450183761, "lower_limit_cents": 2248.572419574486, "i": 1, "j": 4, "use_case_i": "commute", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 2279.1907724986463, "lower_limit_cents": 2265.5565305893824, "i": 3, "j": 4, "use_case_i": "other", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 2350.92843987647, "lower_limit_cents": 2336.8650593787042, "i": 2, "j": 4, "use_case_i": "party time", "use_case_j": "d5"}]}, "courier_reserve": {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "TargetList", "targets": [{"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1241.1293378504213, "lower_limit_cents": 1233.7048353308776, "i": 0, "j": 0, "use_case_i": "airport", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 727.4371516311899, "lower_limit_cents": 723.0855834260183, "i": 1, "j": 0, "use_case_i": "commute", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 726.2290746143713, "lower_limit_cents": 721.8847331909553, "i": 3, "j": 0, "use_case_i": "other", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 721.8542335535437, "lower_limit_cents": 717.5360626648886, "i": 2, "j": 0, "use_case_i": "party time", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1262.7683007257722, "lower_limit_cents": 1255.2143527652993, "i": 0, "j": 1, "use_case_i": "airport", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 878.7339750743357, "lower_limit_cents": 873.4773411257356, "i": 1, "j": 1, "use_case_i": "commute", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 871.4259003353668, "lower_limit_cents": 866.2129836833109, "i": 3, "j": 1, "use_case_i": "other", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 836.9719972890816, "lower_limit_cents": 831.9651857399946, "i": 2, "j": 1, "use_case_i": "party time", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1291.4763632354884, "lower_limit_cents": 1283.7506820994836, "i": 0, "j": 2, "use_case_i": "airport", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 887.858995554582, "lower_limit_cents": 882.5477752421917, "i": 1, "j": 2, "use_case_i": "commute", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 901.8927033818186, "lower_limit_cents": 896.4975326736522, "i": 3, "j": 2, "use_case_i": "other", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 900.2945061562592, "lower_limit_cents": 894.9088959499408, "i": 2, "j": 2, "use_case_i": "party time", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1494.3744526731987, "lower_limit_cents": 1485.4350242424518, "i": 0, "j": 3, "use_case_i": "airport", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1103.2995015607755, "lower_limit_cents": 1096.699504542466, "i": 1, "j": 3, "use_case_i": "commute", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1095.7236308058098, "lower_limit_cents": 1089.1689530542299, "i": 3, "j": 3, "use_case_i": "other", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1171.7071598838056, "lower_limit_cents": 1164.697944570443, "i": 2, "j": 3, "use_case_i": "party time", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 2374.330037171652, "lower_limit_cents": 2360.1266670589603, "i": 0, "j": 4, "use_case_i": "airport", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1941.3374727102398, "lower_limit_cents": 1929.7242874298197, "i": 1, "j": 4, "use_case_i": "commute", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1922.4212975823903, "lower_limit_cents": 1910.9212698800031, "i": 3, "j": 4, "use_case_i": "other", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 2009.087137477251, "lower_limit_cents": 1997.0686700546555, "i": 2, "j": 4, "use_case_i": "party time", "use_case_j": "d5"}]}}}'
prod_markup_str = '{"flyte_id": "ex:priceoptimizeroffline:production:fec74ada2d39d42b483c", "region": "BNA", "model_version": "bandit_grid_pricing_v3_shared", "model_versions_to_flyte_ids": {"bandit_grid_pricing_v3_shared": "ex:priceoptimizeroffline:production:fec74ada2d39d42b483c", "bandit_model_compi_v2_n_modes_airport_niw": "", "compi_model_v2": "ex:priceoptimizeroffline:production:f8e354058ee3e4edb8ba", "cost_decomposition_model_v10_insurance_shapley": ""}, "model_id": null, "model_versions_to_lls_model_ids": null, "optimal_base_markup": {"standard": {"commute": {"d3": 1.6531026726283682, "d1": 2.5524407063621206, "d5": 1.178615131841822, "d4": 1.337261870350407, "d2": 2.143446998258206}, "party time": {"d1": 2.5416835256260026, "d4": 1.4810915727402967, "d5": 1.2776550559757507, "d2": 2.074908068222295, "d3": 1.7416773028190886}, "other": {"d4": 1.369091316442288, "d5": 1.198544558158128, "d1": 2.5760221064788604, "d2": 2.189896376521325, "d3": 1.7430180914588633}, "airport": {"d2": 1.8571783247985405, "d5": 1.1058001325600677, "d3": 1.6066738363736075, "d1": 2.5160464037811523, "d4": 1.3857237276080667}}, "standard_saver": {"party time": {"d5": 1.2062931633129914, "d4": 1.3971837329532621, "d1": 2.2159463141739404, "d2": 1.8018852208793414, "d3": 1.5867117067554428}, "airport": {"d1": 2.0297105132197153, "d4": 1.2794212983046, "d5": 1.0293144410759654, "d2": 1.4710471546257293, "d3": 1.4128387100209907}, "other": {"d2": 1.8997919974179047, "d3": 1.5849712703295626, "d1": 2.243516549021919, "d5": 1.130462788277775, "d4": 1.2875938742341053}, "commute": {"d3": 1.5015191989599541, "d5": 1.1110692549168988, "d2": 1.8561798995176704, "d1": 2.219230435139846, "d4": 1.258111128433596}}, "courier_reserve": {"airport": {"d4": 1.1397234035070107, "d1": 2.036952787483708, "d3": 1.1622533438817357, "d2": 1.6217126503261625, "d5": 1.0563220911799935}, "party time": {"d4": 1.300511810616598, "d5": 1.2540600411450527, "d2": 2.007634046724319, "d1": 2.3241281453232903, "d3": 1.4906907096931459}, "commute": {"d4": 1.1991045081429044, "d5": 1.1675207320616212, "d2": 2.100104899569568, "d3": 1.4449138888902628, "d1": 2.3669885811715377}, "other": {"d1": 2.3627319078923557, "d2": 2.1105254449053317, "d5": 1.1650548994833414, "d4": 1.1996197552021337, "d3": 1.483940354091546}}}, "additional_adjustment": null, "standard_saver_second_window_multiplier": 1.0, "additional_wedge_multiplier": null, "markup_adjustment_multiplier": null, "price_multiplier": null}'
treat_pt_str = '{"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "TargetDict", "targets": {"standard": {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "TargetList", "targets": [{"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1587.149560569238, "lower_limit_cents": 1577.655146448186, "i": 1, "j": 0, "use_case_i": "airport_drop_off", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1703.2268160217702, "lower_limit_cents": 1693.0380215091777, "i": 1, "j": 1, "use_case_i": "airport_drop_off", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1817.4229217749614, "lower_limit_cents": 1806.5510000096078, "i": 1, "j": 2, "use_case_i": "airport_drop_off", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2097.1683836986886, "lower_limit_cents": 2084.623009519036, "i": 1, "j": 3, "use_case_i": "airport_drop_off", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2798.6118900826023, "lower_limit_cents": 2781.8704430831053, "i": 1, "j": 4, "use_case_i": "airport_drop_off", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1697.9659371160851, "lower_limit_cents": 1687.808613464344, "i": 0, "j": 0, "use_case_i": "airport_pick_up", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1944.2583737543964, "lower_limit_cents": 1932.6277154866734, "i": 0, "j": 1, "use_case_i": "airport_pick_up", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2049.6388572528713, "lower_limit_cents": 2037.3778072593348, "i": 0, "j": 2, "use_case_i": "airport_pick_up", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2286.1733176955518, "lower_limit_cents": 2272.4973058249902, "i": 0, "j": 3, "use_case_i": "airport_pick_up", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2924.3242205714573, "lower_limit_cents": 2906.830755642815, "i": 0, "j": 4, "use_case_i": "airport_pick_up", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 860.2146278721473, "lower_limit_cents": 855.0687776555643, "i": 2, "j": 0, "use_case_i": "commute", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1038.184946599928, "lower_limit_cents": 1031.9744683550632, "i": 2, "j": 1, "use_case_i": "commute", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1245.9740733123442, "lower_limit_cents": 1238.520589324434, "i": 2, "j": 2, "use_case_i": "commute", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1599.0531760639847, "lower_limit_cents": 1589.4875538741705, "i": 2, "j": 3, "use_case_i": "commute", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2430.5719610762694, "lower_limit_cents": 2416.0321487468004, "i": 2, "j": 4, "use_case_i": "commute", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 858.3332708892495, "lower_limit_cents": 853.1986750514277, "i": 4, "j": 0, "use_case_i": "other", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1033.0910825252956, "lower_limit_cents": 1026.9110760495712, "i": 4, "j": 1, "use_case_i": "other", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1269.804484182284, "lower_limit_cents": 1262.2084453935568, "i": 4, "j": 2, "use_case_i": "other", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1587.2537638607957, "lower_limit_cents": 1577.7587263900434, "i": 4, "j": 3, "use_case_i": "other", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2422.0204930023947, "lower_limit_cents": 2407.531836015342, "i": 4, "j": 4, "use_case_i": "other", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 852.8048915823334, "lower_limit_cents": 847.703366807165, "i": 3, "j": 0, "use_case_i": "party time", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 988.9700560900858, "lower_limit_cents": 983.053983969906, "i": 3, "j": 1, "use_case_i": "party time", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1245.5602027658497, "lower_limit_cents": 1238.1091945738308, "i": 3, "j": 2, "use_case_i": "party time", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 1639.8517763593943, "lower_limit_cents": 1630.042094746078, "i": 3, "j": 3, "use_case_i": "party time", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 0, "upper_limit_cents": 2470.4339130519447, "lower_limit_cents": 2455.6556443796503, "i": 3, "j": 4, "use_case_i": "party time", "use_case_j": "d5"}]}, "standard_saver": {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "TargetList", "targets": [{"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1399.845405871237, "lower_limit_cents": 1391.4714552877601, "i": 1, "j": 0, "use_case_i": "airport_drop_off", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1512.7682101802525, "lower_limit_cents": 1503.7187493018066, "i": 0, "j": 0, "use_case_i": "airport_pick_up", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 756.853203306179, "lower_limit_cents": 752.3256666961721, "i": 2, "j": 0, "use_case_i": "commute", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 755.0746821774937, "lower_limit_cents": 750.5577847766315, "i": 4, "j": 0, "use_case_i": "other", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 750.380660432157, "lower_limit_cents": 745.8918429220944, "i": 3, "j": 0, "use_case_i": "party time", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1498.7231986981099, "lower_limit_cents": 1489.7577558345122, "i": 1, "j": 1, "use_case_i": "airport_drop_off", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1707.6114669394838, "lower_limit_cents": 1697.3964432090384, "i": 0, "j": 1, "use_case_i": "airport_pick_up", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 913.6624519090227, "lower_limit_cents": 908.1968739315013, "i": 2, "j": 1, "use_case_i": "commute", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 908.984532362227, "lower_limit_cents": 903.5469379512866, "i": 4, "j": 1, "use_case_i": "other", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 870.0347280321076, "lower_limit_cents": 864.8301334476683, "i": 3, "j": 1, "use_case_i": "party time", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1670.999250288073, "lower_limit_cents": 1661.0032428087827, "i": 1, "j": 2, "use_case_i": "airport_drop_off", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1867.753136034398, "lower_limit_cents": 1856.5801362176421, "i": 0, "j": 2, "use_case_i": "airport_pick_up", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1146.643318441341, "lower_limit_cents": 1139.7840363768864, "i": 2, "j": 2, "use_case_i": "commute", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1168.1347906823714, "lower_limit_cents": 1161.1469454739026, "i": 4, "j": 2, "use_case_i": "other", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1145.4877666698742, "lower_limit_cents": 1138.6353971783299, "i": 3, "j": 2, "use_case_i": "party time", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1992.0591611908715, "lower_limit_cents": 1980.1425560391813, "i": 1, "j": 3, "use_case_i": "airport_drop_off", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 2194.647120480852, "lower_limit_cents": 2181.518623249661, "i": 0, "j": 3, "use_case_i": "airport_pick_up", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1519.2467733832607, "lower_limit_cents": 1510.1585573909383, "i": 2, "j": 3, "use_case_i": "commute", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1507.8227863253514, "lower_limit_cents": 1498.8029092386596, "i": 4, "j": 3, "use_case_i": "other", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 1557.6401520680702, "lower_limit_cents": 1548.322264817414, "i": 3, "j": 3, "use_case_i": "party time", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 2658.690049397791, "lower_limit_cents": 2642.7856223824506, "i": 1, "j": 4, "use_case_i": "airport_drop_off", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 3022.7895379586607, "lower_limit_cents": 3004.707048200184, "i": 0, "j": 4, "use_case_i": "airport_pick_up", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 2309.91187732691, "lower_limit_cents": 2296.0938601145854, "i": 2, "j": 4, "use_case_i": "commute", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 2300.6091619169274, "lower_limit_cents": 2286.8467940490295, "i": 4, "j": 4, "use_case_i": "other", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 10, "upper_limit_cents": 2345.9712178825744, "lower_limit_cents": 2331.937491753666, "i": 3, "j": 4, "use_case_i": "party time", "use_case_j": "d5"}]}, "courier_reserve": {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "TargetList", "targets": [{"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1487.4468367892862, "lower_limit_cents": 1478.5488497297292, "i": 1, "j": 0, "use_case_i": "airport_drop_off", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1445.899739107863, "lower_limit_cents": 1437.2502890234693, "i": 0, "j": 0, "use_case_i": "airport_pick_up", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 728.8409713851114, "lower_limit_cents": 724.4810054545924, "i": 2, "j": 0, "use_case_i": "commute", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 726.7554183220901, "lower_limit_cents": 722.4079282822771, "i": 4, "j": 0, "use_case_i": "other", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 724.3921915045667, "lower_limit_cents": 720.0588384148086, "i": 3, "j": 0, "use_case_i": "party time", "use_case_j": "d1"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1366.5700439061743, "lower_limit_cents": 1358.3951483294675, "i": 1, "j": 1, "use_case_i": "airport_drop_off", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1652.2687762382957, "lower_limit_cents": 1642.3848154631912, "i": 0, "j": 1, "use_case_i": "airport_pick_up", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 876.2027805654, "lower_limit_cents": 870.9612883586279, "i": 2, "j": 1, "use_case_i": "commute", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 869.6528900663138, "lower_limit_cents": 864.4505796571435, "i": 4, "j": 1, "use_case_i": "other", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 838.0236939350186, "lower_limit_cents": 833.0105910799738, "i": 3, "j": 1, "use_case_i": "party time", "use_case_j": "d2"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1319.649985325849, "lower_limit_cents": 1311.7557680656746, "i": 1, "j": 2, "use_case_i": "airport_drop_off", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1495.8418331203238, "lower_limit_cents": 1486.893626740741, "i": 0, "j": 2, "use_case_i": "airport_pick_up", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 894.2791952872284, "lower_limit_cents": 888.9295689943837, "i": 2, "j": 2, "use_case_i": "commute", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 902.1119406251072, "lower_limit_cents": 896.7154584279481, "i": 4, "j": 2, "use_case_i": "other", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 902.4499747914285, "lower_limit_cents": 897.0514704556873, "i": 3, "j": 2, "use_case_i": "party time", "use_case_j": "d3"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1613.3225787939195, "lower_limit_cents": 1603.6715962687317, "i": 1, "j": 3, "use_case_i": "airport_drop_off", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1668.8420306599005, "lower_limit_cents": 1658.8589277845672, "i": 0, "j": 3, "use_case_i": "airport_pick_up", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1118.7148534678856, "lower_limit_cents": 1112.0226409845286, "i": 2, "j": 3, "use_case_i": "commute", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1101.3709718786895, "lower_limit_cents": 1094.7825114287673, "i": 4, "j": 3, "use_case_i": "other", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1175.3414338139305, "lower_limit_cents": 1168.3104780782542, "i": 3, "j": 3, "use_case_i": "party time", "use_case_j": "d4"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 3729.5551999999993, "lower_limit_cents": 3707.2448, "i": 1, "j": 4, "use_case_i": "airport_drop_off", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 2402.677929035058, "lower_limit_cents": 2388.3049803070317, "i": 0, "j": 4, "use_case_i": "airport_pick_up", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1964.20463357874, "lower_limit_cents": 1952.4546557108713, "i": 2, "j": 4, "use_case_i": "commute", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 1934.1746094953098, "lower_limit_cents": 1922.6042728482794, "i": 4, "j": 4, "use_case_i": "other", "use_case_j": "d5"}, {"_module": "priceoptimizerlib.data_objects.price_target", "_dataclass": "AbsoluteTarget", "mode_index": 11, "upper_limit_cents": 2004.5184668156082, "lower_limit_cents": 1992.527329426881, "i": 3, "j": 4, "use_case_i": "party time", "use_case_j": "d5"}]}}}'
treat_markup_str = '{"flyte_id": "ex:priceoptimizeroffline:production:b7i65ko75i", "region": "BNA", "model_version": "bandit_grid_pricing_v3_shared_airport_pudo", "model_versions_to_flyte_ids": {"bandit_grid_pricing_v3_shared_airport_pudo": "ex:priceoptimizeroffline:production:b7i65ko75i", "bandit_model_compi_v2_n_modes_airport_niw": "", "compi_model_v2": "ex:priceoptimizeroffline:production:f8e354058ee3e4edb8ba", "cost_decomposition_model_v10_insurance_shapley": ""}, "model_id": null, "model_versions_to_lls_model_ids": null, "optimal_base_markup": {"standard_saver": {"airport_pick_up": {"d3": 1.2169119220364208, "d5": 1.0640722731137606, "d1": 1.2383074210085374, "d4": 1.29157785487374, "d2": 1.1212410381318962}, "airport_drop_off": {"d1": 1.3541708301760598, "d5": 1.0475221228436418, "d3": 1.2431975857296214, "d4": 1.287096079202162, "d2": 1.1547449087242632}, "commute": {"d3": 1.5067796263356623, "d4": 1.2696856535273435, "d5": 1.1297340007359367, "d2": 1.845135426887316, "d1": 2.2224009715674513}, "other": {"d5": 1.1320175885920025, "d1": 2.243900212269174, "d2": 1.8903889173292243, "d4": 1.2888398563956571, "d3": 1.5796314858669682}, "party time": {"d3": 1.5872020896193175, "d5": 1.1977045987729737, "d4": 1.400118421060639, "d2": 1.8037350710371332, "d1": 2.225693335085079}}, "standard": {"party time": {"d3": 1.7422748660672274, "d4": 1.4842333570731143, "d2": 2.0773484187707205, "d5": 1.268409191729633, "d1": 2.552947962822376}, "other": {"d5": 1.2007939371925207, "d1": 2.577030508982761, "d4": 1.3710713242065111, "d2": 2.1801335615788675, "d3": 1.7378198267014784}, "airport_drop_off": {"d5": 1.1215362777998037, "d3": 1.4058344357711126, "d2": 1.404033011776378, "d1": 1.654798985127483, "d4": 1.3838549391679278}, "commute": {"d4": 1.3506515113386575, "d1": 2.556394688939559, "d3": 1.6596395293274304, "d5": 1.198720380558113, "d2": 2.131706937025316}, "airport_pick_up": {"d2": 1.3958249135847294, "d4": 1.3942943821265803, "d5": 1.1068013181854244, "d1": 1.5891119978648574, "d3": 1.3993430481319011}}, "courier_reserve": {"other": {"d1": 2.3590299628233162, "d3": 1.477092651747945, "d4": 1.2025585403512251, "d2": 2.090695165678421, "d5": 1.1677464429624327}, "airport_drop_off": {"d2": 1.296220468943617, "d5": 1.1297406286852887, "d1": 1.5802008468584596, "d4": 1.1749752856679114, "d3": 1.1096956580274515}, "commute": {"d1": 2.3649809056831246, "d2": 2.0781256547947575, "d4": 1.2089147395536686, "d5": 1.1831991976531309, "d3": 1.44729776404445}, "airport_pick_up": {"d3": 1.1649455086621066, "d2": 1.4579140349725883, "d1": 1.5285866280048628, "d4": 1.1449347461304484, "d5": 1.0517543865204728}, "party time": {"d3": 1.48308317938035, "d1": 2.3267888025350327, "d4": 1.298464953439671, "d2": 1.991492653096621, "d5": 1.2413160960643266}}}, "additional_adjustment": null, "standard_saver_second_window_multiplier": 1.0, "additional_wedge_multiplier": null, "markup_adjustment_multiplier": null, "price_multiplier": null}'

def order_dict(dictionary)->Dict[str,Any]:
    result = {}
    for k, v in sorted(dictionary.items()):
        if isinstance(v, dict):
            result[k] = order_dict(v)
        else:
            result[k] = v
    return result

def get_aggregate_data_dict(prod_markup_str, treat_markup_str, prod_pt_str, treat_pt_str)->Dict[str,Any]:
    prod_markup_dict = json.loads(prod_markup_str)
    treat_markup_dict = json.loads(treat_markup_str)
    prod_pt_dict = json.loads(prod_pt_str)
    treat_pt_dict = json.loads(treat_pt_str)
    data_dict={}

    # populate treatment data
    for ride_type, use_case_dict in treat_markup_dict['optimal_base_markup'].items():
        if ride_type not in data_dict:
            data_dict[ride_type] = {}
        
        for use_case,dist_buckets_dict in use_case_dict.items():
            if use_case not in data_dict[ride_type]:
                data_dict[ride_type][use_case] = {}

            for dist_bucket, markup_val in dist_buckets_dict.items():
                if dist_bucket not in data_dict[ride_type][use_case]:
                    data_dict[ride_type][use_case][dist_bucket] = {
                        'prod markup': "DNE",
                        'treat markup': "DNE",
                        'prod pt': "DNE",
                        'treat pt': "DNE",
                    }
                
                data_dict[ride_type][use_case][dist_bucket]['treat markup'] = round(markup_val,4)

    # populate prod data
    for ride_type, use_case_dict in prod_markup_dict['optimal_base_markup'].items():
        if ride_type not in data_dict:
            data_dict[ride_type] = {}
        
        for use_case,dist_buckets_dict in use_case_dict.items():
            if use_case not in data_dict[ride_type]:
                data_dict[ride_type][use_case] = {}

            for dist_bucket, markup_val in dist_buckets_dict.items():
                if dist_bucket not in data_dict[ride_type][use_case]:
                    data_dict[ride_type][use_case][dist_bucket] = {
                        'prod markup': "DNE",
                        'treat markup': "DNE",
                        'prod pt': "DNE",
                        'treat pt': "DNE",
                    }
                
                data_dict[ride_type][use_case][dist_bucket]['prod markup'] = round(markup_val,4)
    
    #populate treatment pt
    for ride_type, config_dict in treat_pt_dict['targets'].items():
        targets_list = config_dict['targets']
        for pt in targets_list:
            use_case = pt['use_case_i']
            dist_bucket = pt['use_case_j']
            pt_val = (pt['lower_limit_cents']+pt['upper_limit_cents'])/2
            pt_val = round(pt_val,4)
            data_dict[ride_type][use_case][dist_bucket]['treat pt'] = pt_val

    #populate prod pt
    for ride_type, config_dict in prod_pt_dict['targets'].items():
        targets_list = config_dict['targets']
        for pt in targets_list:
            use_case = pt['use_case_i']
            dist_bucket = pt['use_case_j']
            pt_val = (pt['lower_limit_cents']+pt['upper_limit_cents'])/2
            pt_val = round(pt_val,4)
            data_dict[ride_type][use_case][dist_bucket]['prod pt'] = pt_val

    data_dict = order_dict(data_dict)    
    return data_dict

def create_csv_with_markups_comp(region, prod_markup_str, treat_markup_str, prod_pt_str, treat_pt_str):

    aggr_data = get_aggregate_data_dict(prod_markup_str, treat_markup_str, prod_pt_str, treat_pt_str)
    col_names = ['ride_type','use_case','dist_bucket','prod_markup','treat_markup','markup_%delta','markup_airport_equivalent (%delta)', 'prod_pt', 'treat_pt', 'pt_airport_equivalent (%delta)']
    with open(f'csv_files/{region}.txt', 'w') as file:
        writer = csv.DictWriter(file,fieldnames=col_names)
        writer.writeheader()
        
        for ride_type in aggr_data:
            for use_case in aggr_data[ride_type]:
                for dist_bucket in aggr_data[ride_type][use_case]:
                    prod_markup = aggr_data[ride_type][use_case][dist_bucket]['prod markup']
                    treat_markup = aggr_data[ride_type][use_case][dist_bucket]['treat markup']
                    prod_pt = aggr_data[ride_type][use_case][dist_bucket]['prod pt']
                    treat_pt = aggr_data[ride_type][use_case][dist_bucket]['treat pt']

                    if prod_markup != 'DNE' and treat_markup != 'DNE':
                        markup_delta = round((treat_markup-prod_markup)/prod_markup*100,4)
                    else:
                        markup_delta = 'DNE'
                    
                    if use_case == 'airport_drop_off' or use_case == 'airport_pick_up':
                        prod_markup_airport_equivalent = aggr_data[ride_type]['airport'][dist_bucket]['prod markup']
                        percent_diff = round((treat_markup-prod_markup_airport_equivalent)/prod_markup_airport_equivalent*100,4)
                        airport_markup_comp_str = f'{prod_markup_airport_equivalent} ({percent_diff}%)'

                        prod_pt_airport_equivalent = aggr_data[ride_type]['airport'][dist_bucket]['prod pt']
                        percent_diff = round((treat_pt-prod_pt_airport_equivalent)/prod_pt_airport_equivalent*100,4)
                        airport_pt_comp_str = f'{prod_pt_airport_equivalent} ({percent_diff}%)'

                    else:
                        airport_markup_comp_str = 'DNE'
                        airport_pt_comp_str = 'DNE'

                    prod_row_entry = {
                        'ride_type': ride_type,
                        'use_case': use_case,
                        'dist_bucket': dist_bucket,
                        'prod_markup':prod_markup,
                        'treat_markup':treat_markup,
                        'markup_%delta':markup_delta,
                        'markup_airport_equivalent (%delta)':airport_markup_comp_str,
                        'prod_pt': prod_pt,
                        'treat_pt': treat_pt,
                        'pt_airport_equivalent (%delta)':airport_pt_comp_str
                    }
                    writer.writerow(prod_row_entry)

create_csv_with_markups_comp(region, prod_markup_str, treat_markup_str, prod_pt_str, treat_pt_str)


